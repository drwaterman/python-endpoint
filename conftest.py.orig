from multiprocessing import Process
import hug


def pytest_sessionstart(session):
    """
    Run a hug server in a separate Process
    """
    global server_proc  # global so handle to process can be accessed in `pytest_sessionfinish`

    hugapi = hug.API('api')  # looks for an API defined in `api.py` (i.e. a local module named `api`)
    server_proc = Process(target=hugapi.http.serve,
                          kwargs={'display_intro': False})

    server_proc.daemon = True
    server_proc.start()


def pytest_sessionfinish(session):
    """
    Terminate the hug server
    """
    global server_proc
    server_proc.terminate()
